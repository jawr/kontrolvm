{% extends 'base_fluid.html' %}
{% block title %}{{ user }}{% endblock %}
{% block content %}
  <h1>Hello {{ user }}</h1>

  <ul class="nav nav-tabs">
    <li {% if not request.GET.page %}class="active"{% endif %}><a href="#overview" data-toggle="tab">Overview</a></li>
    <li {% if request.GET.page %}class="active"{% endif %}><a href="#messages" data-toggle="tab">Messages{% if messages|length > 0 %} ({{ messages|length }}){% endif %}</a></li>
  </ul>

  <div class="tab-content">
    <div class="tab-pane fade {% if not request.GET.page %}in active{% endif %}" id="overview"> 
      <h2>Overview</h2>
      {% if my_instances_online or my_instances_offline %}
        <hr>
        <h3>Instances <i class="icon-hdd"></i> <small>A quick look at all my instances...</small></h3>
        <table class="table table-condensed table-striped">
        {% if my_instances_online %}
          <tr>
            <th>Online</th>
            <td>{{ my_instances_online|length }}</td>
          </tr>
          {% for instance in my_instances_online %}
            <tr><td></td><td><a href="/instance/{{ instance.name }}/">{{ instance }}</a></td></tr>
          {% endfor %}
        </table>
        {% endif %}
        {% if my_instances_offline %}
          <tr>
            <th>Offline</th>
            <td>{{ my_instances_offline|length }}</td>
          </tr>
          {% for instance in my_instances_offline %}
            <tr><td></td><td><a href="/instance/{{ instance.name }}/">{{ instance }}</a></td></tr>
          {% endfor %}
        </table>
        {% endif %}
      {% endif %}
      {% if request.user.is_staff %}
      <hr>
      <h3>Admin <i class="icon-flag"></i> <small>Manage your nodes...</small></h3>
      <div class="span2">
        <table class="table table-condensed table-striped">
          <tr>
            <th colspan="3">Hypervisors</th>
          </tr>
          <tr>
            <td width="20"></td>
            <td width="20">Online</td>
            <td>{{ hypervisors_online }}</td>
          </tr>
          <tr>
            <td></td>
            <td>Offline</td>
            <td>{{ hypervisors_offline }}</td>
          </tr>
        </table>
      </div>
      <div class="span2">
        <table class="table table-condensed table-striped">
          <tr>
            <th colspan="3">Storage Pools</th>
          </tr>
          <tr>
            <td width="20"></td>
            <td width="20">Online</td>
            <td>{{ storagepools_online }}</td>
          </tr>
          <tr>
            <td></td>
            <td>Offline</td>
            <td>{{ storagepools_offline }}</td>
          </tr>
        </table>
      </div>
      <div class="span2">
        <table class="table table-condensed table-striped">
          <tr>
            <th colspan="3">Volumes</th>
          </tr>
          <tr>
            <td width="20"></td>
            <td width="20">Online</td>
            <td>{{ volumes_online }}</td>
          </tr>
          <tr>
            <td></td>
            <td>Offline</td>
            <td>{{ volumes_offline }}</td>
          </tr>
        </table>
      </div>
      <div class="span2">
        <table class="table table-condensed table-striped">
          <tr>
            <th colspan="3">Instances</th>
          </tr>
          <tr>
            <td width="20"></td>
            <td width="20">Online</td>
            <td>{{ instances_online }}</td>
          </tr>
          <tr>
            <td></td>
            <td>Offline</td>
            <td>{{ instances_offline }}</td>
          </tr>
        </table>
      </div>
      <div class="span2">
        <table class="table table-condensed table-striped">
          <tr>
            <th colspan="3">Installation Disks</th>
          </tr>
          <tr>
            <td width="20"></td>
            <td width="20">Disks</td>
            <td>{{ installationdisks }}</td>
          </tr>
          <tr>
            <td></td>
            <td>Tasks</td>
            <td>{{ installationdisktasks }}</td>
          </tr>
        </table>
      </div>
      <div class="span2">
        <table class="table table-condensed table-striped">
          <tr>
            <th colspan="3">VNC Sessions</th>
          </tr>
          <tr>
            <td width="20"></td>
            <td width="20">Active</td>
            <td>{{ vnc_sessions }}/({{ vnc_sessions_rt }})</td>
          </tr>
          <tr>
            <td></td>
            <td>Total</td>
            <td>{{ vnc_sessions_total}}</td>
          </tr>
        </table>
      </div>
      {% endif %}
    </div>
    <div class="tab-pane fade {% if request.GET.page %}in active{% endif %}" id="messages">
      <h2>Messages</h2>
      {% load message_utils %}
      {% if unread_messages %}
        <h3>Unread messages</h3>
        {% for message in unread_messages %}
          <blockquote>
            <p class="text-{{ message.level|message_level_as_text }}">{{ message }}</p>
            <small><a class="muted" href="{% url message_mark_read message.pk %}">mark as read</a> - {{ message.created }}</small>
          </blockquote>
        {% endfor %}
      {% endif %}
      {% if read_messages %}
        {% load pagination_tags %}
        <h3>Read messages</h3>
        {% autopaginate read_messages 5 %}
        {% for message in read_messages %}
          <blockquote>
            <p class="text-{{ message.level|message_level_as_text }}">{{ message }}</p>
            <small>{{ message.created }}</small>
          </blockquote>
        {% endfor %}
        {% paginate %}  
      {% endif %}
    </div>
  </div>
{% endblock %}
